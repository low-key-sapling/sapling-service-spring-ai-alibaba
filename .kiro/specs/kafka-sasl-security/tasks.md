# 实施计划

- [ ] 1. 创建安全配置属性类
  - 创建包含 SASL 机制、用户名、密码和 SSL 配置的 ZfKafkaSecurity 类
  - 创建用于 SSL/TLS 配置属性的 SslConfig 类
  - 添加验证注解和适当的数据绑定支持
  - _需求: 1.3, 2.1, 2.2, 5.2_

- [ ] 2. 扩展现有属性类以支持安全配置
  - [ ] 2.1 更新 ZfKafkaProperties 以包含安全配置
    - 添加 @NestedConfigurationProperty ZfKafkaSecurity security 字段
    - 保持与现有配置结构的向后兼容性
    - _需求: 1.1, 1.3, 3.4_

  - [ ] 2.2 更新 ZfKafkaProducer 以支持安全配置
    - 添加 @NestedConfigurationProperty ZfKafkaSecurity security 字段
    - 允许生产者特定的安全配置覆盖
    - _需求: 1.1, 3.1_

  - [ ] 2.3 更新 ZfKafkaConsumer 以支持安全配置
    - 添加 @NestedConfigurationProperty ZfKafkaSecurity security 字段
    - 允许消费者特定的安全配置覆盖
    - _需求: 1.1, 3.1_

- [ ] 3. 实现安全配置构建器和验证器
  - [ ] 3.1 创建 SecurityConfigBuilder 类
    - 实现用于 SASL 配置的 buildSecurityConfig 方法
    - 实现用于 SSL/TLS 配置的 buildSslConfig 方法
    - 添加对 PLAIN、SCRAM-SHA-256 和 SCRAM-SHA-512 机制的支持
    - _需求: 2.1, 2.2, 2.4, 5.1_

  - [ ] 3.2 实现安全配置验证
    - 添加带有机制特定验证的 validateSecurityConfig 方法
    - 实现凭据格式验证而不暴露敏感数据
    - 添加 SSL 证书配置验证
    - _需求: 2.4, 4.4, 5.1, 5.2_

  - [ ] 3.3 添加凭据掩码工具
    - 实现用于日志记录和错误消息的凭据掩码
    - 确保敏感信息永远不会在日志中暴露
    - _需求: 4.1, 4.3_

- [ ] 4. 增强 KafkaDynamicSourceRegister 以支持安全配置
  - [ ] 4.1 更新 producerConfig 方法以包含安全配置
    - 将 SASL 配置集成到生产者属性中
    - 当同时配置 SASL 和 SSL 时添加 SSL 配置
    - 保持非安全配置的向后兼容性
    - _需求: 1.1, 3.2, 5.1_

  - [ ] 4.2 更新 consumerConfig 方法以包含安全配置
    - 将 SASL 配置集成到消费者属性中
    - 当同时配置 SASL 和 SSL 时添加 SSL 配置
    - 保持非安全配置的向后兼容性
    - _需求: 1.1, 3.2, 5.1_

  - [ ] 4.3 向 afterPropertiesSet 方法添加安全验证
    - 在应用程序启动期间验证安全配置
    - 为配置问题提供清晰的错误消息
    - 确保无效安全配置的快速失败行为
    - _需求: 2.4, 5.2, 5.3_

  - [ ] 4.4 增强 getDataSource 方法以支持安全配置继承
    - 实现从全局到数据源级别的安全配置继承
    - 允许数据源特定的安全配置覆盖
    - 维护配置优先级规则
    - _需求: 3.1, 3.2_

- [ ] 5. 添加全面的错误处理和日志记录
  - [ ] 5.1 实现安全感知的错误消息
    - 为常见配置问题创建详细的错误消息
    - 在错误消息中包含配置示例
    - 确保错误消息中不暴露敏感信息
    - _需求: 4.4, 5.2, 5.3_

  - [ ] 5.2 添加安全事件日志记录
    - 记录安全配置验证结果
    - 记录认证事件而不暴露凭据
    - 为常见问题添加故障排除信息
    - _需求: 4.1, 4.3_

- [ ] 6. 创建全面的测试套件





  - [ ]* 6.1 为安全属性类编写单元测试
    - 测试所有安全机制的配置绑定
    - 测试不同安全配置的验证逻辑
    - 测试凭据掩码功能
    - _需求: 1.3, 2.4, 4.1_

  - [ ]* 6.2 为安全配置编写集成测试
    - 测试多数据源安全配置
    - 测试 SSL + SASL 集成场景
    - 测试与现有配置的向后兼容性
    - _需求: 3.1, 3.2, 5.1_

  - [ ]* 6.3 编写安全验证测试
    - 测试认证失败处理
    - 测试配置验证边缘情况
    - 测试错误消息生成而不暴露凭据
    - _需求: 4.3, 4.4, 5.2_

- [ ] 7. 更新文档和配置示例
  - [ ] 7.1 使用安全配置示例更新 README.md
    - 为每个支持的机制添加 SASL 配置示例
    - 添加 SSL + SASL 配置示例
    - 为常见安全问题添加故障排除部分
    - _需求: 2.1, 2.2, 5.3_

  - [ ] 7.2 创建安全配置参考文档
    - 记录所有安全配置属性
    - 提供机制特定的配置要求
    - 添加凭据管理的最佳实践
    - _需求: 2.4, 4.2, 5.2_